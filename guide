1. Chuáº©n bá»‹ mÃ´i trÆ°á»ng
a. EC2 Instance cho tá»«ng thÃ nh pháº§n
Táº¡o 3 mÃ¡y EC2: Má»™t cho DB, má»™t cho Backend (BE) vÃ  má»™t cho Frontend (FE).

CÃ i Ä‘áº·t Docker:
TrÃªn má»—i mÃ¡y EC2, cÃ i Ä‘áº·t Docker. VÃ­ dá»¥ trÃªn Ubuntu:

bash
Sao chÃ©p
Chá»‰nh sá»­a
sudo apt-get update
sudo apt-get install -y docker.io
sudo systemctl enable docker
sudo systemctl start docker
CÃ i Ä‘áº·t Docker Compose (náº¿u cáº§n): Náº¿u báº¡n cáº§n cháº¡y nhiá»u container liÃªn quan (vÃ­ dá»¥: cháº¡y DB container vá»›i cÃ¡c thÃ´ng sá»‘ cáº¥u hÃ¬nh phá»©c táº¡p) thÃ¬ cÃ³ thá»ƒ cÃ i Ä‘áº·t Docker Compose.

b. Chuáº©n bá»‹ GitLab Runner
Báº¡n cÃ³ thá»ƒ lá»±a chá»n:

Shared Runners cá»§a GitLab: Náº¿u báº¡n dÃ¹ng shared runners thÃ¬ pháº£i cáº¥u hÃ¬nh káº¿t ná»‘i SSH tá»›i cÃ¡c mÃ¡y EC2 Ä‘á»ƒ triá»ƒn khai.

CÃ i Ä‘áº·t GitLab Runner riÃªng trÃªn má»—i EC2: Má»—i runner cÃ³ thá»ƒ cáº¥u hÃ¬nh tag riÃªng, sau Ä‘Ã³ trong .gitlab-ci.yml báº¡n chá»‰ Ä‘á»‹nh cháº¡y job trÃªn runner cÃ³ tag tÆ°Æ¡ng á»©ng (vÃ­ dá»¥: tag â€œdbâ€, â€œbeâ€, â€œfeâ€).

2. Cáº¥u trÃºc repository vÃ  Dockerfile
Giáº£ sá»­ cáº¥u trÃºc dá»± Ã¡n nhÆ° sau:

css
Sao chÃ©p
Chá»‰nh sá»­a
project-root/
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ... (code cáº¥u hÃ¬nh db)
â”œâ”€â”€ be/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ... (code backend)
â””â”€â”€ fe/
    â”œâ”€â”€ Dockerfile
    â””â”€â”€ ... (code frontend)
Dockerfile: Má»—i thÆ° má»¥c Ä‘á»u cÃ³ Dockerfile riÃªng Ä‘á»ƒ build image tÆ°Æ¡ng á»©ng.

3. Cáº¥u hÃ¬nh GitLab CI/CD
Táº¡o file .gitlab-ci.yml á»Ÿ gá»‘c dá»± Ã¡n. Ã tÆ°á»Ÿng chÃ­nh lÃ :

Táº¡o 3 job: build-deploy-db, build-deploy-be, build-deploy-fe.

Sá»­ dá»¥ng Ä‘iá»u kiá»‡n rules/changes Ä‘á»ƒ job chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i trong thÆ° má»¥c tÆ°Æ¡ng á»©ng.

Trong má»—i job:

Build Docker image cho thÃ nh pháº§n Ä‘Ã³.

Äáº©y image lÃªn registry (GitLab Container Registry hoáº·c Docker Hub) náº¿u cáº§n.

Triá»ƒn khai lÃªn mÃ¡y EC2 thÃ´ng qua SSH (hoáº·c dÃ¹ng GitLab Runner cÃ i Ä‘áº·t trá»±c tiáº¿p trÃªn EC2).

a. Cáº¥u hÃ¬nh â€œrules: changesâ€
VÃ­ dá»¥, job cho backend chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i trong thÆ° má»¥c be/:

yaml
Sao chÃ©p
Chá»‰nh sá»­a
rules:
  - changes:
      - be/**/* 
TÆ°Æ¡ng tá»± cho db vÃ  fe.


ğŸš€ BÆ°á»›c 1: CÃ i Ä‘áº·t GitLab Runner trÃªn má»—i EC2
Thá»±c hiá»‡n trÃªn tá»«ng mÃ¡y EC2 (DB, BE, FE).

ğŸ”¹ 1.1. Cáº­p nháº­t há»‡ thá»‘ng & cÃ i Ä‘áº·t GitLab Runner
bash
Sao chÃ©p
Chá»‰nh sá»­a
sudo apt-get update -y
sudo apt-get install -y curl git unzip
curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash
sudo apt-get install -y gitlab-runner
ğŸ”¹ 1.2. Kiá»ƒm tra phiÃªn báº£n
bash
Sao chÃ©p
Chá»‰nh sá»­a
gitlab-runner --version
ğŸ’¡ Káº¿t quáº£ mong Ä‘á»£i: Xuáº¥t hiá»‡n phiÃªn báº£n cá»§a GitLab Runner.

ğŸš€ BÆ°á»›c 2: ÄÄƒng kÃ½ GitLab Runner vá»›i GitLab
Báº¡n cáº§n láº¥y URL & Token tá»« GitLab:

VÃ o GitLab â†’ Project cá»§a báº¡n.

Settings â†’ CI/CD â†’ Runners â†’ Expand.

Láº¥y URL & Registration Token.

ğŸ’¡ Cháº¡y lá»‡nh sau Ä‘á»ƒ Ä‘Äƒng kÃ½ runner trÃªn tá»«ng EC2:

bash
Sao chÃ©p
Chá»‰nh sá»­a
sudo gitlab-runner register
Nháº­p cÃ¡c thÃ´ng tin:

GitLab URL: (VÃ­ dá»¥) https://gitlab.com/

Token: (DÃ¡n token tá»« GitLab)

MÃ´ táº£ Runner: Nháº­p EC2-DB, EC2-BE, EC2-FE

Tags: Nháº­p db, be, fe tÆ°Æ¡ng á»©ng vá»›i tá»«ng EC2

Executor: Chá»n docker

ğŸ’¡ Kiá»ƒm tra láº¡i danh sÃ¡ch runner

bash
Sao chÃ©p
Chá»‰nh sá»­a
sudo gitlab-runner list
âœ” Náº¿u tháº¥y EC2-DB, EC2-BE, EC2-FE xuáº¥t hiá»‡n lÃ  OK.

ğŸš€ BÆ°á»›c 3: Cáº¥u hÃ¬nh Runner Ä‘á»ƒ sá»­ dá»¥ng Docker
Chá»‰nh sá»­a file /etc/gitlab-runner/config.toml

bash
Sao chÃ©p
Chá»‰nh sá»­a
sudo nano /etc/gitlab-runner/config.toml
ThÃªm hoáº·c cáº­p nháº­t cáº¥u hÃ¬nh:

toml
Sao chÃ©p
Chá»‰nh sá»­a
[[runners]]
  name = "EC2-BE"
  url = "https://gitlab.com/"
  token = "YOUR_RUNNER_TOKEN"
  executor = "docker"
  [runners.custom_build_dir]
  [runners.docker]
    tls_verify = false
    image = "docker:latest"
    privileged = true
    disable_entrypoint_overwrite = false
    oom_kill_disable = false
    disable_cache = false
    volumes = ["/cache"]
  [runners.cache]
ğŸ’¾ LÆ°u láº¡i vÃ  thoÃ¡t (CTRL + X â†’ Y â†’ ENTER).

Khá»Ÿi Ä‘á»™ng láº¡i Runner:

bash
Sao chÃ©p
Chá»‰nh sá»­a
sudo gitlab-runner restart
ğŸš€ BÆ°á»›c 4: Kiá»ƒm tra Runner trÃªn GitLab
VÃ o GitLab â†’ Settings â†’ CI/CD â†’ Runners
âœ” Náº¿u tháº¥y EC2-DB, EC2-BE, EC2-FE Ä‘ang hoáº¡t Ä‘á»™ng lÃ  OK.

ğŸš€ BÆ°á»›c 5: Cáº­p nháº­t .gitlab-ci.yml Ä‘á»ƒ sá»­ dá»¥ng Ä‘Ãºng Runner
Trong file .gitlab-ci.yml, sá»­a cÃ¡c job Ä‘á»ƒ dÃ¹ng Ä‘Ãºng runner:

yaml
Sao chÃ©p
Chá»‰nh sá»­a
build-deploy-db:
  stage: build
  tags:
    - db
  script:
    - echo "Äang build image cho DB..."
    - docker build -t myrepo/db:$CI_COMMIT_REF_NAME .
    - docker push myrepo/db:$CI_COMMIT_REF_NAME
TÆ°Æ¡ng tá»± cho BE vÃ  FE:

yaml
Sao chÃ©p
Chá»‰nh sá»­a
build-deploy-be:
  stage: build
  tags:
    - be
  script:
    - echo "Äang build image cho Backend..."
    - docker build -t myrepo/be:$CI_COMMIT_REF_NAME .
    - docker push myrepo/be:$CI_COMMIT_REF_NAME

build-deploy-fe:
  stage: build
  tags:
    - fe
  script:
    - echo "Äang build image cho Frontend..."
    - docker build -t myrepo/fe:$CI_COMMIT_REF_NAME .
    - docker push myrepo/fe:$CI_COMMIT_REF_NAME
ğŸš€ Tá»•ng káº¿t
âœ… CÃ i Ä‘áº·t GitLab Runner trÃªn tá»«ng EC2.
âœ… ÄÄƒng kÃ½ vá»›i GitLab, cáº¥u hÃ¬nh cháº¡y Docker.
âœ… Sá»­ dá»¥ng tags (db, be, fe) Ä‘á»ƒ chá»‰ Ä‘á»‹nh job cháº¡y Ä‘Ãºng runner.

â¡ Tá»« bÃ¢y giá», má»—i láº§n push code lÃªn GitLab, runner trÃªn EC2 sáº½ tá»± Ä‘á»™ng build & deploy! ğŸš€







Báº¡n Ä‘Ã£ nÃ³i:
Ä‘ang thao tÃ¡c trong ec2 hay lÃ  web


ChatGPT Ä‘Ã£ nÃ³i:
Báº¡n sáº½ thá»±c hiá»‡n cáº£ hai:

1ï¸âƒ£ TrÃªn EC2: CÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh GitLab Runner báº±ng terminal (SSH).
2ï¸âƒ£ TrÃªn GitLab Web: Láº¥y GitLab URL & Token trong CI/CD Settings.
3ï¸âƒ£ TrÃªn EC2: ÄÄƒng kÃ½ runner vá»›i GitLab vÃ  chá»‰nh sá»­a .gitlab-ci.yml.

Cá»¥ thá»ƒ:

Náº¿u báº¡n Ä‘ang thao tÃ¡c trÃªn EC2, hÃ£y má»Ÿ terminal SSH vÃ  cháº¡y cÃ¡c lá»‡nh hÆ°á»›ng dáº«n.

Náº¿u báº¡n cáº§n láº¥y token, hÃ£y má»Ÿ GitLab Web â†’ Settings â†’ CI/CD â†’ Runners.
